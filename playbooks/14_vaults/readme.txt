Ansible-vault - механизм шифрования переменных и файлов, который помогает спрятать секретные данные. 

Там где хранится inventory файл лежит group_vars/all/vault.yml - все .yml файлы в этой директории будут подгружаться автоматически во время выполнения плейбуков (при добавлении ключа --ask-vault-pass). 

* на текущий момент я переименовал group_vars в _group_vars, т.к. ansible реально стал при любом другом запросе, даже не требующем vaults, пытаться к нему обращаться. 

Зашифровать файл:

ansible-vault encrypt group_vars/all/vault.yml

Ansible запросит пароль. После шифрования содержимое файла будет выглядеть примерно так:

$ANSIBLE_VAULT;1.1;AES256
66353133343061653262393732666166313962303936626431303464363563663534386534373237
3034636362613338353739323131616465303762333431300a383838383937623565666436616162
63623934323662313466643839643466623635366138666136333361316432376464633639333862
3938323664663435310a336666666565376562363565643965346231643133333937376238326537
3539


Для выполнения плейбука с зашифрованным файлом:

ansible-playbook -i inventory --ask-vault-pass playbook.yml 

Будет запрошен пароль. 


Чтобы постоянно не вводить пароль, его можно положить в какой-нибудь файл, исключенный из контроля версий, и указать к нему путь:

ansible-playbook --vault-password-file /path/to/file ... 

Для изменения зашифрованного файла нужно ввести: 

ansible-vault edit group_vars/all/vault.yml  

будет открыт редактор по умолчанию. 


